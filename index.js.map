{"version":3,"file":"index.js","mappings":"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","sources":["webpack://ntut-farewell-app-rollup/./src/ts/routes.ts","webpack://ntut-farewell-app-rollup/./src/html/landing.html","webpack://ntut-farewell-app-rollup/./src/html/starting.html","webpack://ntut-farewell-app-rollup/./src/html/message.html","webpack://ntut-farewell-app-rollup/./src/html/ending.html","webpack://ntut-farewell-app-rollup/./src/ts/state.ts","webpack://ntut-farewell-app-rollup/./src/ts/index.ts","webpack://ntut-farewell-app-rollup/./src/ts/Router.ts"],"sourcesContent":["import messageBoxes from \"../data/message-boxes.json\";\nimport EndingPage from \"../html/ending.html\";\nimport LandingPage from \"../html/landing.html\";\nimport MessagesPage from \"../html/message.html\";\nimport StartingPage from \"../html/starting.html\";\nfunction findMessageBox(name) {\n    return messageBoxes[name];\n}\nexport default {\n    \"\": class {\n        constructor(router) {\n            this.router = router;\n            this.html = LandingPage;\n            this.background = \"index.png\";\n            this.containerClass = \"index-page\";\n        }\n        buttonClickHandler() {\n            const name = document.getElementById(\"name-input\").value;\n            const passcode = document.getElementById(\"magic-word-input\").value;\n            if (!Object.keys(messageBoxes).includes(name)) {\n                alert(\"名字輸入錯了 QAQ\");\n                return null;\n            }\n            if (findMessageBox(name).passcode != passcode) {\n                alert(\"通關密語錯了，偷看壞壞哦！\");\n                return null;\n            }\n            // Cache background images\n            for (let i = 1; i <= 4; i++)\n                new Image().src = `img/backgrounds/${name}/${i}.jpg`;\n            new Image().src = `img/backgrounds/ending.jpg`;\n            const backgroundMusic = new Audio(\"/music/background-music.mp3\");\n            backgroundMusic.loop = true;\n            backgroundMusic.play();\n            this.router.state.name = name;\n            return \"starting\";\n        }\n    },\n    starting: class {\n        constructor() {\n            this.html = StartingPage;\n            this.background = \"index.png\";\n            this.containerClass = \"message-page\";\n            this.buttonClickHandler = () => \"messages\";\n        }\n    },\n    messages: class {\n        constructor(router) {\n            this.router = router;\n            this.html = MessagesPage;\n            this.background = (router) => `${router.state.name}/1`;\n            this.containerClass = \"message-page\";\n            this.currentMessageIndex = 0;\n        }\n        displayNextMessage() {\n            const currentMessageContentEl = this.messageContentEls[this.currentMessageIndex];\n            // https://stackoverflow.com/a/31862081\n            const triggerReflow = () => getComputedStyle(currentMessageContentEl).transform;\n            if (this.currentMessageIndex == 0) {\n                currentMessageContentEl.style.transition = \"none\";\n                triggerReflow();\n                currentMessageContentEl.classList.remove(\"next\");\n                triggerReflow();\n                currentMessageContentEl.style.transition = \"\";\n            }\n            else {\n                this.messageContentEls[this.currentMessageIndex - 1].classList.add(\"previous\");\n                currentMessageContentEl.classList.remove(\"next\");\n            }\n            this.router.setBackground(`${this.router.state.name}/${this.currentMessageIndex + 1}`);\n        }\n        initialize() {\n            const messageBox = findMessageBox(this.router.state.name);\n            const messageContainerEl = document.getElementById(\"message-container\");\n            messageContainerEl.innerHTML = messageBox.messages\n                .map(message => `<div class=\"message-content next\">${message\n                .split(\"\\n\\n\")\n                .map(paragraph => `<p>${paragraph.replace(/\\n/g, \"<br>\")}</p>`)\n                .join(\"\")}</div>`)\n                .join(\"\");\n            const messageContentEls = [...messageContainerEl.children];\n            const maximumHeight = messageContentEls.reduce((previousValue, messageContentEl) => {\n                messageContentEl.style.height = \"unset\";\n                const elHeight = messageContentEl.clientHeight;\n                messageContentEl.style.height = \"\";\n                if (elHeight > previousValue)\n                    return elHeight;\n                else\n                    return previousValue;\n            }, 0);\n            messageContainerEl.style.height = `${maximumHeight}px`;\n            this.messageBox = messageBox;\n            this.messageContentEls = messageContentEls;\n            // this.displayNextMessage() requires this.messageContentEls\n            this.displayNextMessage();\n        }\n        buttonClickHandler() {\n            this.currentMessageIndex++;\n            if (this.currentMessageIndex < this.messageBox.messages.length) {\n                this.displayNextMessage();\n                return null;\n            }\n            else {\n                return \"ending\";\n            }\n        }\n    },\n    ending: class {\n        constructor() {\n            this.html = EndingPage;\n            this.background = \"ending\";\n            this.containerClass = \"message-page\";\n        }\n    },\n};\n","// Module\nvar code = \"<div class=\\\"input-container\\\"><label for=\\\"name-input\\\">你的名字</label><input id=\\\"name-input\\\"/></div><div class=\\\"input-container\\\"><label for=\\\"magic-word-input\\\">通關密語</label><input id=\\\"magic-word-input\\\"/></div><img id=\\\"button\\\" src=\\\"img/start-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>哈囉哈嘍！</p><p>歡迎你的加入</p><p>這裡存載著我們送給你的禮物</p><p>準備好進入屬於你的回憶世界了嗎？</p></div></div><img id=\\\"button\\\" src=\\\"img/next-page-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\" class=\\\"messages-from-others\\\"></div><img id=\\\"button\\\" src=\\\"img/next-page-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>你在深耕的每一刻<br/>我們永遠記得</p><p>縱使必定悲歡離合<br/>你永遠是我們的大人</p><p>深耕感謝有你</p></div></div>\";\n// Exports\nexport default code;","export default {\n    name: null,\n    authorized: false,\n    containerEl: document.getElementById(\"container\"),\n};\n","import Router from \"./Router\";\nimport routes from \"./routes\";\nimport state from \"./state\";\nnew Router(routes, state);\n","export default class Router {\n    constructor(routes, state) {\n        this.routes = routes;\n        this.state = state;\n        this.push(window.location.pathname.replace(/^\\/*(.*)\\/*$/, \"$1\"));\n    }\n    push(path) {\n        if (this.state.currentPath == path)\n            return;\n        history.pushState({}, \"\", path);\n        this.state.currentPath = path;\n        const newRoute = new this.routes[path](this);\n        this.state.containerEl.className = newRoute.containerClass;\n        this.state.containerEl.innerHTML = newRoute.html;\n        this.setBackground(typeof newRoute.background == \"string\" ? newRoute.background : newRoute.background(this));\n        if (newRoute.initialize != undefined)\n            newRoute.initialize();\n        if (newRoute.buttonClickHandler != undefined) {\n            const buttonClickHandler = newRoute.buttonClickHandler.bind(newRoute);\n            document.getElementById(\"button\").onclick = () => {\n                const newPath = buttonClickHandler(this);\n                if (newPath != null)\n                    this.push(newPath);\n            };\n        }\n    }\n    setBackground(imagePath) {\n        this.state.containerEl.style.backgroundImage = `url(img/backgrounds/${imagePath.includes(\".\") ? imagePath : imagePath + \".jpg\"})`;\n    }\n}\n"],"names":["findMessageBox","name","constructor","router","this","html","background","containerClass","buttonClickHandler","document","getElementById","value","passcode","Object","keys","includes","alert","i","Image","src","backgroundMusic","Audio","loop","play","state","starting","messages","currentMessageIndex","displayNextMessage","currentMessageContentEl","messageContentEls","triggerReflow","getComputedStyle","transform","style","transition","classList","remove","add","setBackground","initialize","messageBox","messageContainerEl","innerHTML","map","message","split","paragraph","replace","join","children","maximumHeight","reduce","previousValue","messageContentEl","height","elHeight","clientHeight","length","ending","authorized","containerEl","routes","push","window","location","pathname","path","currentPath","history","pushState","newRoute","className","undefined","bind","onclick","newPath","imagePath","backgroundImage"],"sourceRoot":""}