{"version":3,"file":"index.js","mappings":"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","sources":["webpack://ntut-farewell-app-rollup/./src/ts/routes.ts","webpack://ntut-farewell-app-rollup/./src/html/landing.html","webpack://ntut-farewell-app-rollup/./src/html/starting.html","webpack://ntut-farewell-app-rollup/./src/html/message.html","webpack://ntut-farewell-app-rollup/./src/html/ending.html","webpack://ntut-farewell-app-rollup/./src/html/feedback.html","webpack://ntut-farewell-app-rollup/./src/ts/state.ts","webpack://ntut-farewell-app-rollup/./src/ts/index.ts","webpack://ntut-farewell-app-rollup/./src/ts/Router.ts"],"sourcesContent":["var _a;\nimport messageBoxes from \"../data/message-boxes.json\";\nimport EndingPage from \"../html/ending.html\";\nimport FeedbackPage from \"../html/feedback.html\";\nimport LandingPage from \"../html/landing.html\";\nimport MessagesPage from \"../html/message.html\";\nimport StartingPage from \"../html/starting.html\";\nexport default {\n    \"\": {\n        html: LandingPage,\n        background: \"index.png\",\n        containerClass: \"index-page\",\n        buttonClickHandler: function (router) {\n            const name = document.getElementById(\"name-input\").value;\n            const passcode = document.getElementById(\"magic-word-input\").value;\n            if (!(name in messageBoxes)) {\n                alert(\"名字輸入錯了 QAQ\");\n                return;\n            }\n            const messageBox = messageBoxes[name];\n            if (messageBox.passcode != passcode) {\n                alert(\"通關密語錯了，偷看壞壞哦！\");\n                return;\n            }\n            // Cache background images\n            for (let i = 1; i <= 4; i++)\n                new Image().src = `/assets/img/backgrounds/${name}/${i}.webp`;\n            new Image().src = `/assets/img/backgrounds/ending.webp`;\n            const backgroundMusic = new Audio(\"/assets/audio/background-music.mp3\");\n            backgroundMusic.loop = true;\n            backgroundMusic.play();\n            router.state.name = name;\n            router.state.messageBox = messageBox;\n            return \"starting\";\n        },\n    },\n    starting: {\n        html: StartingPage,\n        background: \"index.png\",\n        containerClass: \"page-with-text-content\",\n        buttonClickHandler: () => \"messages\",\n    },\n    messages: (_a = class {\n            static initialize(router) {\n                const messageBox = router.state.messageBox;\n                const messageContainerEl = document.getElementById(\"message-container\");\n                if (messageBox == null) {\n                    router.push(\"name\");\n                    return;\n                }\n                messageContainerEl.innerHTML = messageBox.messages\n                    .map(message => `<div class=\"message-content next\">${message\n                    .split(\"\\n\\n\")\n                    .map(paragraph => `<p>${paragraph.replace(/\\n/g, \"<br>\")}</p>`)\n                    .join(\"\")}</div>`)\n                    .join(\"\");\n                const messageContentEls = [...messageContainerEl.children];\n                const maximumHeight = messageContentEls.reduce((previousValue, messageContentEl) => {\n                    messageContentEl.style.height = \"unset\";\n                    const elHeight = messageContentEl.clientHeight;\n                    messageContentEl.style.height = \"\";\n                    if (elHeight > previousValue)\n                        return elHeight;\n                    else\n                        return previousValue;\n                }, 0);\n                messageContainerEl.style.height = `${maximumHeight}px`;\n                this.messageBox = messageBox;\n                this.messageContentEls = messageContentEls;\n                this.router = router;\n                // this.displayNextMessage() requires this.messageContentEls\n                this.displayNextMessage();\n            }\n            static buttonClickHandler() {\n                this.currentMessageIndex++;\n                if (this.currentMessageIndex < this.messageBox.messages.length) {\n                    this.displayNextMessage();\n                    return null;\n                }\n                else {\n                    return \"ending\";\n                }\n            }\n            static displayNextMessage() {\n                const currentMessageContentEl = this.messageContentEls[this.currentMessageIndex];\n                // https://stackoverflow.com/a/31862081\n                const triggerReflow = () => getComputedStyle(currentMessageContentEl).transform;\n                if (this.currentMessageIndex == 0) {\n                    currentMessageContentEl.style.transition = \"none\";\n                    triggerReflow();\n                    currentMessageContentEl.classList.remove(\"next\");\n                    triggerReflow();\n                    currentMessageContentEl.style.transition = \"\";\n                }\n                else {\n                    this.messageContentEls[this.currentMessageIndex - 1].classList.add(\"previous\");\n                    currentMessageContentEl.classList.remove(\"next\");\n                }\n                this.router.setBackground(`${this.router.state.name}/${this.currentMessageIndex + 1}`);\n            }\n        },\n        _a.html = MessagesPage,\n        _a.background = router => `${router.state.name}/1`,\n        _a.containerClass = \"page-with-text-content\",\n        _a.currentMessageIndex = 0,\n        _a),\n    ending: {\n        html: EndingPage,\n        background: \"ending\",\n        containerClass: \"page-with-text-content\",\n        buttonClickHandler: () => \"feedback\",\n    },\n    feedback: {\n        html: FeedbackPage,\n        background: \"ending\",\n        containerClass: \"page-with-text-content\",\n    },\n};\n","// Module\nvar code = \"<div class=\\\"input-container\\\"><label for=\\\"name-input\\\">你的名字</label><input id=\\\"name-input\\\"/></div><div class=\\\"input-container\\\"><label for=\\\"magic-word-input\\\">通關密語</label><input id=\\\"magic-word-input\\\"/></div><img id=\\\"button\\\" src=\\\"/assets/img/start-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>哈囉哈嘍！</p><p>歡迎你的加入</p><p>這裡存載著我們送給你的禮物</p><p>準備好進入屬於你的回憶世界了嗎？</p></div></div><img id=\\\"button\\\" src=\\\"/assets/img/next-page-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\" class=\\\"messages-from-others\\\"></div><img id=\\\"button\\\" src=\\\"/assets/img/next-page-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>你在深耕的每一刻<br/>我們都永遠記得</p><p>縱使必定悲歡離合<br/>你永遠是我們的大人</p><p>深耕感謝有你</p></div></div><img id=\\\"button\\\" src=\\\"/assets/img/not-yet-finished-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>非常感謝大家看完！<br/>相信大家看完後應該很感動吧<br/>我們的送舊就到這邊要結束了嗚嗚嗚<br/>還請大家先填一下我們的回饋表單<br/>給我們一些回饋與建議</p><p><a href=\\\"https://forms.gle/RJShRqCWkSeZvuE89\\\">https://forms.gle/RJShRqCWkSeZvuE89</a></p><p>填完表單之後<br/>就可以拿到可愛的紀念品呦！<br/>但非常抱歉由於現在疫情嚴重<br/>沒辦法立即給大家紀念品<br/>領取紀念品的時間確定後<br/>會在群組公布呦～<br/>大家敬請期待吧！</p></div></div>\";\n// Exports\nexport default code;","export default {\n    name: null,\n    messageBox: null,\n    authorized: false,\n    containerEl: document.getElementById(\"container\"),\n};\n","import Router from \"./Router\";\nimport routes from \"./routes\";\nimport state from \"./state\";\nnew Router(routes, state);\n","export default class Router {\n    constructor(routes, state) {\n        this.routes = routes;\n        this.state = state;\n        this.push(window.location.pathname.replace(/^\\/*(.*)\\/*$/, \"$1\"));\n    }\n    push(path) {\n        if (this.state.currentPath == path)\n            return;\n        history.pushState({}, \"\", path);\n        this.state.currentPath = path;\n        const newRoute = this.routes[path];\n        this.state.containerEl.className = newRoute.containerClass;\n        this.state.containerEl.innerHTML = newRoute.html;\n        this.setBackground(typeof newRoute.background == \"string\" ? newRoute.background : newRoute.background(this));\n        if (\"initialize\" in newRoute)\n            newRoute.initialize(this);\n        if (\"buttonClickHandler\" in newRoute) {\n            document.getElementById(\"button\").onclick = () => {\n                const newPath = newRoute.buttonClickHandler(this);\n                if (newPath != null)\n                    this.push(newPath);\n            };\n        }\n    }\n    setBackground(imagePath) {\n        this.state.containerEl.style.backgroundImage = `url(/assets/img/backgrounds/${imagePath.includes(\".\") ? imagePath : imagePath + \".webp\"})`;\n    }\n}\n"],"names":["_a","html","background","containerClass","buttonClickHandler","router","name","document","getElementById","value","passcode","alert","messageBox","i","Image","src","backgroundMusic","Audio","loop","play","state","starting","messages","static","messageContainerEl","push","innerHTML","map","message","split","paragraph","replace","join","messageContentEls","children","maximumHeight","reduce","previousValue","messageContentEl","style","height","elHeight","clientHeight","this","displayNextMessage","currentMessageIndex","length","currentMessageContentEl","triggerReflow","getComputedStyle","transform","transition","classList","remove","add","setBackground","ending","feedback","authorized","containerEl","constructor","routes","window","location","pathname","path","currentPath","history","pushState","newRoute","className","initialize","onclick","newPath","imagePath","backgroundImage","includes"],"sourceRoot":""}