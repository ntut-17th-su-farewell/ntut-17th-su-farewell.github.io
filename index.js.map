{"version":3,"file":"index.js","mappings":"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","sources":["webpack://ntut-farewell-app-rollup/./src/ts/types.ts","webpack://ntut-farewell-app-rollup/./src/ts/routes.ts","webpack://ntut-farewell-app-rollup/./src/html/landing.html","webpack://ntut-farewell-app-rollup/./src/html/starting.html","webpack://ntut-farewell-app-rollup/./src/html/message.html","webpack://ntut-farewell-app-rollup/./src/html/ending.html","webpack://ntut-farewell-app-rollup/./src/html/feedback.html","webpack://ntut-farewell-app-rollup/./src/ts/state.ts","webpack://ntut-farewell-app-rollup/./src/ts/index.ts","webpack://ntut-farewell-app-rollup/./src/ts/Router.ts"],"sourcesContent":["export class StatefulButtonClickHandler {\n}\nexport class Route {\n    constructor(html, containerClass, background, buttonClickHandler, initialize) {\n        this.html = html;\n        this.containerClass = containerClass;\n        this.background = background;\n        this.buttonClickHandler = buttonClickHandler;\n        this.initialize = initialize;\n    }\n}\n","import messageBoxes from \"../data/message-boxes.json\";\nimport EndingPage from \"../html/ending.html\";\nimport FeedbackPage from \"../html/feedback.html\";\nimport LandingPage from \"../html/landing.html\";\nimport MessagesPage from \"../html/message.html\";\nimport StartingPage from \"../html/starting.html\";\nimport { Route } from \"./types\";\nexport default {\n    \"\": router => new Route(LandingPage, \"index-page\", \"index.png\", () => {\n        const name = document.getElementById(\"name-input\").value;\n        const passcode = document.getElementById(\"magic-word-input\").value;\n        if (!(name in messageBoxes)) {\n            alert(\"名字輸入錯了 QAQ\");\n            return null;\n        }\n        const messageBox = messageBoxes[name];\n        if (messageBox.passcode != passcode) {\n            alert(\"通關密語錯了，偷看壞壞哦！\");\n            return null;\n        }\n        // Cache background images\n        for (let i = 1; i <= 4; i++)\n            new Image().src = `/assets/img/backgrounds/${name}/${i}.webp`;\n        new Image().src = `/assets/img/backgrounds/ending.webp`;\n        const backgroundMusic = new Audio(\"/assets/audio/background-music.mp3\");\n        backgroundMusic.loop = true;\n        backgroundMusic.play();\n        router.state.name = name;\n        router.state.messageBox = messageBox;\n        return \"starting\";\n    }),\n    starting: () => new Route(StartingPage, \"page-with-text-content\", \"index.png\", () => \"messages\"),\n    messages: router => {\n        let currentMessageIndex = 0;\n        let messageContainerEl;\n        let messageContentEls;\n        const messageBox = router.state.messageBox;\n        function displayNextMessage() {\n            const currentMessageContentEl = messageContentEls[currentMessageIndex];\n            // https://stackoverflow.com/a/31862081\n            const triggerReflow = () => getComputedStyle(currentMessageContentEl).transform;\n            if (currentMessageIndex == 0) {\n                currentMessageContentEl.style.transition = \"none\";\n                triggerReflow();\n                currentMessageContentEl.classList.remove(\"next\");\n                triggerReflow();\n                currentMessageContentEl.style.transition = \"\";\n            }\n            else {\n                messageContentEls[currentMessageIndex - 1].classList.add(\"previous\");\n                currentMessageContentEl.classList.remove(\"next\");\n            }\n            router.setBackground(`${router.state.name}/${currentMessageIndex + 1}`);\n        }\n        if (messageBox == null) {\n            router.push(\"name\");\n            return;\n        }\n        return new Route(MessagesPage, \"page-with-text-content\", () => `${router.state.name}/1`, () => {\n            currentMessageIndex++;\n            if (currentMessageIndex < messageBox.messages.length) {\n                displayNextMessage();\n                return null;\n            }\n            else {\n                return \"ending\";\n            }\n        }, () => {\n            messageContainerEl = document.getElementById(\"message-container\");\n            messageContainerEl.innerHTML = messageBox.messages\n                .map(message => `<div class=\"message-content next\">${message\n                .split(\"\\n\\n\")\n                .map(paragraph => `<p>${paragraph.replace(/\\n/g, \"<br>\")}</p>`)\n                .join(\"\")}</div>`)\n                .join(\"\");\n            messageContentEls = [...messageContainerEl.children];\n            const maximumHeight = messageContentEls.reduce((previousValue, messageContentEl) => {\n                messageContentEl.style.height = \"unset\";\n                const elHeight = messageContentEl.clientHeight;\n                messageContentEl.style.height = \"\";\n                if (elHeight > previousValue)\n                    return elHeight;\n                else\n                    return previousValue;\n            }, 0);\n            messageContainerEl.style.height = `${maximumHeight}px`;\n            displayNextMessage();\n        });\n    },\n    ending: () => new Route(EndingPage, \"page-with-text-content\", \"ending\", () => \"feedback\"),\n    feedback: () => new Route(FeedbackPage, \"page-with-text-content\", \"ending\"),\n};\n","// Module\nvar code = \"<div class=\\\"input-container\\\"><label for=\\\"name-input\\\">你的名字</label><input id=\\\"name-input\\\"/></div><div class=\\\"input-container\\\"><label for=\\\"magic-word-input\\\">通關密語</label><input id=\\\"magic-word-input\\\"/></div><img id=\\\"button\\\" src=\\\"/assets/img/start-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>哈囉哈嘍！</p><p>歡迎你的加入</p><p>這裡存載著我們送給你的禮物</p><p>準備好進入屬於你的回憶世界了嗎？</p></div></div><img id=\\\"button\\\" src=\\\"/assets/img/next-page-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\" class=\\\"messages-from-others\\\"></div><img id=\\\"button\\\" src=\\\"/assets/img/next-page-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>你在深耕的每一刻<br/>我們都永遠記得</p><p>縱使必定悲歡離合<br/>你永遠是我們的大人</p><p>深耕感謝有你</p></div></div><img id=\\\"button\\\" src=\\\"/assets/img/not-yet-finished-button.png\\\"/>\";\n// Exports\nexport default code;","// Module\nvar code = \"<div id=\\\"message-container\\\"><div class=\\\"message-content\\\"><p>非常感謝大家看完！<br/>相信大家看完後應該很感動吧<br/>我們的送舊就到這邊要結束了嗚嗚嗚<br/>還請大家先填一下我們的回饋表單<br/>給我們一些回饋與建議</p><p><a href=\\\"https://forms.gle/RJShRqCWkSeZvuE89\\\">https://forms.gle/RJShRqCWkSeZvuE89</a></p><p>填完表單之後<br/>就可以拿到可愛的紀念品呦！<br/>但非常抱歉由於現在疫情嚴重<br/>沒辦法立即給大家紀念品<br/>領取紀念品的時間確定後<br/>會在群組公布呦～<br/>大家敬請期待吧！</p></div></div>\";\n// Exports\nexport default code;","export default {\n    name: null,\n    messageBox: null,\n    authorized: false,\n    containerEl: document.getElementById(\"container\"),\n};\n","import Router from \"./Router\";\nimport routes from \"./routes\";\nimport state from \"./state\";\nnew Router(routes, state);\n","export default class Router {\n    constructor(routes, state) {\n        this.routes = routes;\n        this.state = state;\n        this.push(window.location.pathname.replace(/^\\/*(.*)\\/*$/, \"$1\"));\n    }\n    push(path) {\n        if (this.state.currentPath == path)\n            return;\n        history.pushState({}, \"\", path);\n        this.state.currentPath = path;\n        const newRoute = this.routes[path](this);\n        if (newRoute == undefined)\n            return;\n        this.state.containerEl.className = newRoute.containerClass;\n        this.state.containerEl.innerHTML = newRoute.html;\n        this.setBackground(typeof newRoute.background == \"string\" ? newRoute.background : newRoute.background());\n        if (newRoute.initialize != undefined)\n            newRoute.initialize();\n        if (newRoute.buttonClickHandler != undefined) {\n            document.getElementById(\"button\").onclick = () => {\n                const newPath = newRoute.buttonClickHandler(this);\n                if (newPath != null)\n                    this.push(newPath);\n            };\n        }\n    }\n    setBackground(imagePath) {\n        this.state.containerEl.style.backgroundImage = `url(/assets/img/backgrounds/${imagePath.includes(\".\") ? imagePath : imagePath + \".webp\"})`;\n    }\n}\n"],"names":["Route","constructor","html","containerClass","background","buttonClickHandler","initialize","this","router","name","document","getElementById","value","passcode","alert","messageBox","i","Image","src","backgroundMusic","Audio","loop","play","state","starting","messages","messageContainerEl","messageContentEls","currentMessageIndex","displayNextMessage","currentMessageContentEl","triggerReflow","getComputedStyle","transform","style","transition","classList","remove","add","setBackground","length","innerHTML","map","message","split","paragraph","replace","join","children","maximumHeight","reduce","previousValue","messageContentEl","height","elHeight","clientHeight","push","ending","feedback","authorized","containerEl","routes","window","location","pathname","path","currentPath","history","pushState","newRoute","undefined","className","onclick","newPath","imagePath","backgroundImage","includes"],"sourceRoot":""}